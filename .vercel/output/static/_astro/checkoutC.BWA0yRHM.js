import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.RH_Wq4ov.js";import{C as X}from"./chevron-left.aKcX9v7o.js";import{S as Z}from"./shopping-bag.DlimQM-Z.js";import{C as ee}from"./calendar.CLrY_9Yq.js";import{C as se}from"./clock.iALahFT7.js";import{A as R}from"./arrow-right.1S_H47eA.js";import{C as te,L as re}from"./lock.CKM9AT-q.js";import{c as ae}from"./createLucideIcon.CFjhCtiB.js";import{C as oe}from"./check.DErKrk8i.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],F=ae("credit-card",ne);function je(){const[c,D]=i.useState([]),[j,k]=i.useState(0),[v,m]=i.useState(!1),[l,N]=i.useState(1),[E,z]=i.useState("Débito"),[a,f]=i.useState({cardHolder:"",cardNumber:"",expiryDate:"",cvv:"",email:"",phone:""}),[r,x]=i.useState({}),[y,C]=i.useState(null),[A,_]=i.useState([]),[le,M]=i.useState(null),[p,H]=i.useState(null),[S,b]=i.useState(null);i.useEffect(()=>{O(),L(),window.scrollTo(0,0)},[]),i.useEffect(()=>{l===3&&window.scrollTo(0,0)},[l]),i.useEffect(()=>{p&&V()},[p]);const L=()=>{const t=document.cookie.split(";").find(n=>n.trim().startsWith("auth_token="));if(t){const n=t.trim().substring(11);H(n)}else console.error("Auth token not found in cookies"),x({...r,auth:"No se encontró token de autenticación. Por favor, inicia sesión nuevamente."})},V=async()=>{try{const s=await fetch("https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/reservations",{headers:{Authorization:`Bearer ${p}`}});if(!s.ok)throw s.status===401?new Error("Sesión expirada. Por favor, inicia sesión nuevamente."):new Error(`Error al cargar las reservas: ${s.status}`);const t=await s.json();_(t.reservations||[])}catch(s){console.error("Error al cargar reservaciones existentes:",s)}},O=()=>{const s=localStorage.getItem("salsasCart");if(s){const t=JSON.parse(s);D(t),B(t)}},B=s=>{const t=s.reduce((n,o)=>n+o.price*(o.quantity||1),0);k(t)},h=s=>{const{name:t,value:n}=s.target;if(b(null),t==="cardNumber"){const o=n.replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 ").trim();f({...a,[t]:o.substring(0,19)})}else if(t==="expiryDate"){const o=n.replace(/\D/g,"");o.length<=2?f({...a,[t]:o}):f({...a,[t]:`${o.substring(0,2)}/${o.substring(2,4)}`})}else if(t==="cvv"){const o=n.replace(/\D/g,"");f({...a,[t]:o.substring(0,4)})}else f({...a,[t]:n})},P=()=>{const s={};return(!a.email.trim()||!/^\S+@\S+\.\S+$/.test(a.email))&&(s.email="Por favor, ingresa un email válido"),a.phone.trim()||(s.phone="Por favor, ingresa un teléfono de contacto"),x(s),Object.keys(s).length===0},Y=()=>{const s={};if(a.cardHolder.trim()||(s.cardHolder="Por favor, ingresa el nombre del titular"),(!a.cardNumber.trim()||a.cardNumber.replace(/\s/g,"").length<16)&&(s.cardNumber="Por favor, ingresa un número de tarjeta válido"),!a.expiryDate.trim()||!a.expiryDate.includes("/"))s.expiryDate="Formato inválido (MM/YY)";else{const[t,n]=a.expiryDate.split("/"),o=new Date,d=o.getFullYear()%100,u=o.getMonth()+1;(parseInt(n)<d||parseInt(n)===d&&parseInt(t)<u)&&(s.expiryDate="La tarjeta ha expirado")}return(!a.cvv.trim()||a.cvv.length<3)&&(s.cvv="CVV inválido"),x(t=>({...t,...s})),Object.keys(s).length===0},$=s=>{z(s)},I=()=>{if(l===1)P()&&(N(2),window.scrollTo(0,0));else if(l===2){const s=P(),t=Y();s&&t&&(y?q():J())}},G=()=>{localStorage.removeItem("salsasCart"),D([]),k(0)},Q=()=>{const s=c[0]?.id;return s&&A.find(n=>n.workshop_id===s&&!n.payment_completed)?.id||null},J=async()=>{if(m(!0),b(null),!p){x({...r,auth:"No se encontró token de autenticación. Por favor, inicia sesión nuevamente."}),m(!1);return}try{const s=c[0]?.id;if(!s)throw new Error("No workshop selected");const t=Q();if(t){console.log("Usando reserva existente con ID:",t),C(t),await w(t);return}console.log("Enviando solicitud de reserva con workshop_ids:",[s]);const n=await fetch("https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/reservations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({workshop_ids:[s]})});if(!n.ok){const u=await n.json();throw console.error("Error de respuesta:",u),new Error(`Error al crear la reserva: ${u.error||"Error desconocido"}`)}const o=await n.json();console.log("Respuesta de reserva:",o);let d;if(o.reservations&&o.reservations.length>0)d=o.reservations[0].id;else if(o.reservation)d=o.reservation.id;else throw new Error("No se pudo obtener el ID de reserva de la respuesta");C(d),await w(d)}catch(s){console.error("Error en el proceso de reserva:",s),x({...r,payment:`Error: ${s.message}`}),m(!1)}},q=async()=>{m(!0),b(null);try{await w(y)}catch(s){console.error("Error al procesar el pago:",s),x({...r,payment:`Error: ${s.message}`}),m(!1)}},w=async s=>{try{const t=a.cardNumber.replace(/\s/g,""),n=a.cvv,o=a.expiryDate.split("/"),d=o[0],u=o.length>1?`20${o[1]}`:"";console.log("Procesando pago para reserva:",s);const T=await fetch("https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/payments/verify-card",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({card_number:t,exp_month:d,exp_year:u,cvc:n,reservation_ids:[s]})}),g=await T.json();if(console.log("Respuesta de pago:",g),!T.ok||g.is_valid===!1)throw b(g.message||"Error al procesar el pago"),new Error(g.error||"Error al procesar el pago");M(g.status||"Procesado"),G(),N(3)}catch(t){throw console.error("Error en el proceso de pago:",t),t}finally{m(!1)}},U=s=>s?`•••• •••• •••• ${s.replace(/\s/g,"").slice(-4)}`:"",W=()=>e.jsxs("div",{className:"absolute -z-10 inset-0 overflow-hidden opacity-70 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[20%] -left-[10%] w-[40%] h-[40%] rounded-full bg-gradient-to-br from-[#D94F4F]/20 to-transparent blur-3xl"}),e.jsx("div",{className:"absolute top-[60%] -right-[10%] w-[30%] h-[30%] rounded-full bg-gradient-to-br from-[#6B8E23]/20 to-transparent blur-3xl"})]}),K=()=>{switch(l){case 1:return"Resumen de compra";case 2:return"Información de pago";case 3:return"Confirmación de compra";default:return"Checkout"}};return e.jsxs("div",{className:"min-h-screen bg-[#FAFAFA] pt-16",children:[e.jsx(W,{}),e.jsxs("main",{className:"container mx-auto px-4 md:px-6 py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("a",{href:l===1?"/workshops":"#",onClick:s=>{l!==1&&(s.preventDefault(),N(l-1))},className:"text-[#333333] hover:text-[#D94F4F] transition-colors flex items-center gap-2",children:[e.jsx(X,{size:20}),e.jsx("span",{className:"font-medium",children:l===1?"Continuar comprando":"Volver"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${l>=1?"bg-[#D94F4F]":"bg-[#E5E5E5]"}`}),e.jsx("span",{className:`w-3 h-3 rounded-full ${l>=2?"bg-[#D94F4F]":"bg-[#E5E5E5]"}`}),e.jsx("span",{className:`w-3 h-3 rounded-full ${l>=3?"bg-[#D94F4F]":"bg-[#E5E5E5]"}`})]})]}),e.jsx("h1",{className:"text-3xl font-bold text-[#333333] mb-8",children:K()}),l===1&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white  border border-[#E5E5E5] p-6",children:[e.jsx("h2",{className:"text-xl font-medium text-[#333333] mb-4",children:"Talleres seleccionados"}),c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto text-[#E5E5E5] mb-4"}),e.jsx("p",{className:"text-[#666666]",children:"No hay talleres en tu carrito"}),e.jsx("a",{href:"/workshops",className:"mt-4 inline-block text-[#D94F4F] hover:underline",children:"Explorar talleres disponibles"})]}):e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"flex gap-4 py-4 border-b border-[#E5E5E5] last:border-b-0",children:[e.jsx("div",{className:"h-24 w-24 bg-[#F5F5F5] overflow-hidden",children:e.jsx("img",{src:s.imageUrl||"/api/placeholder/100/100",alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-[#333333]",children:s.name}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-x-4 gap-y-1 text-sm text-[#666666]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{size:14,className:"text-[#D94F4F]"}),e.jsx("span",{children:s.date})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{size:14,className:"text-[#D94F4F]"}),e.jsx("span",{children:s.time})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-medium text-[#D94F4F]",children:["GTQ ",parseFloat(s.price).toFixed(2)]})})]},s.id))})]}),e.jsxs("div",{className:"bg-white  border border-[#E5E5E5] p-6",children:[e.jsx("h2",{className:"text-xl font-medium text-[#333333] mb-4",children:"Información de contacto"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-[#666666] mb-1",children:"Correo electrónico"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:h,className:`w-full p-3 border ${r.email?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D94F4F]/50`,placeholder:"tu@email.com"}),r.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-[#666666] mb-1",children:"Teléfono de contacto"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:a.phone,onChange:h,className:`w-full p-3 border ${r.phone?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D94F4F]/50`,placeholder:"(+502) 1234-5678"}),r.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.phone})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-[#E5E5E5] p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-medium text-[#333333] mb-4",children:"Resumen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[#666666]",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["GTQ ",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[#666666]",children:"Impuestos"}),e.jsx("span",{className:"text-[#666666]",children:"Incluidos"})]}),e.jsx("div",{className:"border-t border-[#E5E5E5] my-2 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-[#333333]",children:"Total"}),e.jsxs("span",{className:"font-bold text-xl text-[#D94F4F]",children:["GTQ ",j.toFixed(2)]})]})}),e.jsxs("button",{onClick:I,disabled:c.length===0,className:`w-full mt-6 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-all ${c.length===0?"bg-[#E5E5E5] text-[#999999] cursor-not-allowed":"bg-[#D94F4F] text-white hover:bg-[#c04545] shadow-md"}`,children:["Continuar al pago",e.jsx(R,{size:18})]}),(r.email||r.phone)&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 text-red-600 rounded-lg text-sm",children:"Por favor completa todos los campos requeridos."}),r.payment&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 text-red-600 rounded-lg text-sm",children:r.payment})]})]})})]}),l===2&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white border border-[#E5E5E5] p-6",children:[e.jsx("h2",{className:"text-xl font-medium text-[#333333] mb-4",children:"Método de pago"}),S&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3",children:[e.jsx(te,{size:20,className:"text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700",children:"Error de pago"}),e.jsx("p",{className:"text-sm text-red-600",children:S})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>$("Débito"),className:`flex-1 min-w-[120px] p-3 rounded-lg border ${E==="Débito"?"border-[#D94F4F] bg-[#FFF3E2] text-[#D94F4F]":"border-[#E5E5E5] text-[#666666]"} transition-all flex items-center justify-center gap-2`,children:[e.jsx(F,{size:18}),e.jsx("span",{children:"Débito"})]}),e.jsxs("button",{onClick:()=>$("Crédito"),className:`flex-1 min-w-[120px] p-3 rounded-lg border ${E==="Crédito"?"border-[#D94F4F] bg-[#FFF3E2] text-[#D94F4F]":"border-[#E5E5E5] text-[#666666]"} transition-all flex items-center justify-center gap-2`,children:[e.jsx(F,{size:18}),e.jsx("span",{children:"Crédito"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cardHolder",className:"block text-sm font-medium text-[#666666] mb-1",children:"Nombre del titular"}),e.jsx("input",{type:"text",id:"cardHolder",name:"cardHolder",value:a.cardHolder,onChange:h,className:`w-full p-3 border ${r.cardHolder?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D94F4F]/50`,placeholder:"Nombre como aparece en la tarjeta"}),r.cardHolder&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.cardHolder})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cardNumber",className:"block text-sm font-medium text-[#666666] mb-1",children:"Número de tarjeta"}),e.jsxs("div",{className:`flex items-center w-full p-3 border ${r.cardNumber?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus-within:ring-2 focus-within:ring-[#D94F4F]/50`,children:[e.jsx("input",{type:"text",id:"cardNumber",name:"cardNumber",value:a.cardNumber,onChange:h,className:"flex-1 focus:outline-none",placeholder:"1234 5678 9012 3456",maxLength:"19"}),e.jsx(F,{size:18,className:"text-[#666666]"})]}),r.cardNumber&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.cardNumber})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiryDate",className:"block text-sm font-medium text-[#666666] mb-1",children:"Fecha de expiración"}),e.jsx("input",{type:"text",id:"expiryDate",name:"expiryDate",value:a.expiryDate,onChange:h,className:`w-full p-3 border ${r.expiryDate?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D94F4F]/50`,placeholder:"MM/YY",maxLength:"5"}),r.expiryDate&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.expiryDate})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cvv",className:"block text-sm font-medium text-[#666666] mb-1",children:"CVV/CVC"}),e.jsx("input",{type:"text",id:"cvv",name:"cvv",value:a.cvv,onChange:h,className:`w-full p-3 border ${r.cvv?"border-red-500":"border-[#E5E5E5]"} rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D94F4F]/50`,placeholder:"123",maxLength:"4"}),r.cvv&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.cvv})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white border border-[#E5E5E5] p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-medium text-[#333333] mb-4",children:"Resumen"}),e.jsxs("div",{className:"space-y-4",children:[c.length>0&&e.jsxs("div",{className:"text-sm text-[#666666]",children:[e.jsxs("p",{children:[c.length," ",c.length===1?"taller":"talleres"," seleccionados"]}),e.jsxs("p",{className:"font-medium text-[#333333] line-clamp-1 mt-1",children:[c[0]?.name,c.length>1&&` y ${c.length-1} más`]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[#666666]",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["GTQ ",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[#666666]",children:"Impuestos"}),e.jsx("span",{className:"text-[#666666]",children:"Incluidos"})]}),e.jsx("div",{className:"border-t border-[#E5E5E5] my-2 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-[#333333]",children:"Total"}),e.jsxs("span",{className:"font-bold text-xl text-[#D94F4F]",children:["GTQ ",j.toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center text-xs text-[#666666] gap-2 py-2",children:[e.jsx(re,{size:14}),e.jsx("span",{children:"Pago seguro. Tus datos están protegidos."})]}),e.jsx("button",{onClick:I,disabled:v,className:`w-full mt-4 py-3 rounded-lg flex items-center justify-center gap-2 font-medium transition-all ${v?"bg-[#E5E5E5] text-[#999999] cursor-not-allowed":"bg-[#D94F4F] text-white hover:bg-[#c04545] shadow-md"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-t-white border-white/30 rounded-full animate-spin"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Realizar pago"}),e.jsx(R,{size:18})]})}),r.payment&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 text-red-600 rounded-lg text-sm",children:r.payment})]})]})})]}),l===3&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-[#E5E5E5] p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-[#6B8E23]/20 flex items-center justify-center mx-auto mb-6",children:e.jsx(oe,{size:40,className:"text-[#6B8E23]"})}),e.jsx("h2",{className:"text-2xl font-bold text-[#333333] mb-2",children:"¡Pago completado con éxito!"}),e.jsx("p",{className:"text-[#666666] mb-6",children:"Tu reservación para el taller ha sido confirmada. Hemos enviado los detalles a tu correo electrónico."}),e.jsx("div",{className:"bg-[#F5F5F5] rounded-lg p-6 mb-8",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[#666666]",children:"Número de reservación:"}),e.jsxs("p",{className:"font-medium text-[#333333]",children:["#",y]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[#666666]",children:"Estado:"}),e.jsx("p",{className:"font-medium text-[#333333]",children:"Confirmada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[#666666]",children:"Fecha:"}),e.jsx("p",{className:"font-medium text-[#333333]",children:new Date().toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[#666666]",children:"Método de pago:"}),e.jsx("p",{className:"font-medium text-[#333333]",children:E})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-[#666666]",children:"Número de tarjeta:"}),e.jsx("p",{className:"font-medium text-[#333333]",children:U(a.cardNumber)})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("a",{href:"/",className:"px-6 py-3 bg-[#FAFAFA] border border-[#E5E5E5] rounded-lg text-[#333333] hover:bg-[#F5F5F5] transition-colors",children:"Volver al inicio"}),e.jsx("a",{href:"/workshops",className:"px-6 py-3 bg-[#D94F4F] text-white rounded-lg hover:bg-[#c04545] transition-colors",children:"Explorar más talleres"})]})]})})]})]})}export{je as default};

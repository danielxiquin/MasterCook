import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BVOCwoKb.js";import{X as P}from"./x.DEifBwhW.js";import{c as h}from"./createLucideIcon.BlEPHBTn.js";import{C as B}from"./calendar.DEHqqP1v.js";import{C as H}from"./clock.DUAitnum.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],re=h("chevron-down",ae);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],le=h("chevron-up",oe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ce=h("funnel",ne);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],de=h("search",ie);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],he=h("tag",me);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xe=h("triangle-alert",ue),I={1:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuMuhOjpzB02MisAEvYjHQhPGucaFX54CJrUOn",2:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu7htBM8RilvS4mGda0BVPYjrps1H5Lf6DObNF",3:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuBHsdxLPb6lrQWNcyYFdnfEzkeVHJXgoMawmD",4:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibutFnAGpualz2QAIYZWuOfsk5nxJDdbcVy1pe4",5:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibutHioByualz2QAIYZWuOfsk5nxJDdbcVy1pe4",6:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibumctXQLNrPvHGd1j2UM5sACiWEgXI6atVnYyz",7:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuuXdUT8fyXR7wfFas8jC0PIStrJ3dMb4ZeBKD",8:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuInmtowlAyO8kqw0XmJiTH3EQFBVbCG4o2UaS",9:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuEbSDr1NQ3G5DiXUHsPJjl4xCBKmyotakWeFZ",10:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu6VjN9FHvu4jTO7gzRm3dXnqYyJGwxA5VLMkc",11:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuabLKK2ABUdWKHfOIM621lGQbSXNs5CArhFxz",12:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu5F9013ZRtlECNGU1HWj4bcvBhzO65xgwroMF"},Ne=()=>{const[d,j]=r.useState(null),[z,R]=r.useState([]),[D,c]=r.useState(!0),[A,u]=r.useState(null),[b,O]=r.useState(""),[w,U]=r.useState("all"),[v,L]=r.useState(!1),[x,y]=r.useState(null),[pe,X]=r.useState({}),[J,N]=r.useState(!1),[p,k]=r.useState(null),[C,M]=r.useState(!1),[f,_]=r.useState(null);r.useEffect(()=>{T(),window.scrollTo(0,0)},[]),r.useEffect(()=>{d?V():c(!1)},[d]),r.useEffect(()=>{if(f){const s=setTimeout(()=>{_(null)},5e3);return()=>clearTimeout(s)}},[f]);const T=()=>{const t=document.cookie.split(";").find(o=>o.trim().startsWith("auth_token="));if(t){const o=t.trim().substring(11);j(o)}else console.log("No se encontró token de autenticación en cookies"),c(!1)},V=async()=>{try{(await fetch("https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/auth/me",{headers:{Authorization:`Bearer ${d}`}})).ok?(N(!0),W()):(console.error("Token inválido o expirado"),G(),j(null),N(!1),c(!1))}catch(s){console.error("Error al verificar el token:",s),u("Error al verificar la autenticación"),c(!1)}},G=()=>{document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},W=async()=>{if(!d){c(!1);return}c(!0),u(null);try{const s=await fetch("https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/reservations",{headers:{Authorization:`Bearer ${d}`}});if(!s.ok)throw s.status===401?(G(),j(null),N(!1),new Error("Sesión expirada. Por favor, inicia sesión nuevamente.")):new Error(`Error al cargar las reservas: ${s.status}`);let o=(await s.json()).reservations||[];const i=new Date;i.setHours(0,0,0,0);const n=o.map(a=>{const l=new Date(a.workshop_date);return l.setHours(0,0,0,0),l<i&&a.status==="Confirmada"?{...a,status:"Completada"}:a}),m=n.filter((a,l)=>a.status==="Completada"&&o[l].status!=="Completada");await Promise.all(m.map(a=>$(a.id,"Completada",!1)));const ee=[...new Set(n.map(a=>a.workshop_id))].map(a=>fetch(`http://localhost:5002/api/workshops/${a}`).then(l=>l.ok?l.json():{workshop:null}).then(l=>[a,l.workshop]).catch(l=>(console.error(`Error fetching workshop ${a}:`,l),[a,null]))),se=await Promise.all(ee),te=Object.fromEntries(se.filter(a=>a[1]!==null));m.length>0&&(o=n),R(o),X(te),c(!1)}catch(s){console.error("Error in fetchReservations:",s),u(s.message||"Error al cargar las reservas"),c(!1)}},$=async(s,t,o=!0)=>{try{const i=await fetch(`https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/reservations/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({status:t})});if(!i.ok)throw new Error(`Error al actualizar la reserva: ${i.status}`);return R(n=>n.map(m=>m.id===s?{...m,status:t}:m)),x&&x.id===s&&y(n=>({...n,status:t})),o&&_({Cancelada:"Reserva cancelada exitosamente",Confirmada:"Reserva confirmada exitosamente",Completada:"Reserva marcada como completada"}[t]||"Estado de reserva actualizado"),!0}catch(i){return console.error("Error updating reservation status:",i),u(`Error al ${t==="Cancelada"?"cancelar":"actualizar"} la reserva. Por favor, inténtalo de nuevo.`),!1}},Q=async()=>{if(!p)return;M(!0);const s=await $(p.id,"Cancelada");M(!1),s&&k(null)},E=s=>{const t={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date(s).toLocaleDateString("es-ES",t)},g=s=>s,S=z.filter(s=>{const t=s.workshop_name.toLowerCase().includes(b.toLowerCase())||s.status.toLowerCase().includes(b.toLowerCase()),o=w==="all"||s.status.toLowerCase()===w.toLowerCase();return t&&o}),q=s=>{y(s)},F=()=>{y(null)},Y=({reservation:s})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4 text-red-600",children:[e.jsx(xe,{size:24,className:"mr-2"}),e.jsx("h2",{className:"text-xl font-bold",children:"¿Cancelar reserva?"})]}),e.jsxs("p",{className:"mb-6",children:["¿Estás seguro de que deseas cancelar tu reserva para ",e.jsx("strong",{children:s.workshop_name})," del ",E(s.workshop_date),"? Esta acción no se puede deshacer."]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>k(null),className:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:C,children:"Volver"}),e.jsx("button",{onClick:Q,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Cancelando..."]}):"Cancelar Reserva"})]})]})}):null,K=({reservation:s})=>{if(!s)return null;const t=I[s.workshop_id]||"/api/placeholder/400/300",o=new Date,n=new Date(s.workshop_date)>o&&s.status!=="Cancelada"&&s.status!=="Completada";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg border border-[#e0dfdf] w-full max-w-3xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Detalles de la Reserva"}),e.jsx("button",{onClick:F,className:"text-gray-500 hover:text-gray-700",children:e.jsx(P,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("img",{src:t,alt:s.workshop_name,className:"w-full h-64 object-cover"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.workshop_name}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"text-gray-500 mr-2",size:16}),e.jsx("span",{children:E(s.workshop_date)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"text-gray-500 mr-2",size:16}),e.jsxs("span",{children:[g(s.workshop_start_time)," - ",g(s.workshop_end_time)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"text-gray-500 mr-2",size:16}),e.jsxs("span",{children:["Modalidad: ",s.workshop_modality]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium mr-2 ${s.payment_status?.toLowerCase()==="pagado"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["Pago: ",s.payment_status||"Pendiente"]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status?.toLowerCase()==="confirmada"?"bg-blue-100 text-blue-800":s.status?.toLowerCase()==="cancelada"?"bg-red-100 text-red-800":s.status?.toLowerCase()==="completada"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:["Estado: ",s.status||"Pendiente"]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"font-semibold",children:"Precio:"}),e.jsxs("p",{className:"text-2xl font-bold text-accent-color",children:["$",s.workshop_price]})]}),n&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{F(),k(s)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Cancelar Reserva"})})]})]}),e.jsx("div",{className:"mt-6 border-t pt-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Reserva #",s.id," • Creada el ",new Date(s.created_at).toLocaleDateString()]})})]})})})},Z=[{value:"all",label:"Todos los estados"},{value:"confirmada",label:"Confirmada"},{value:"cancelada",label:"Cancelada"},{value:"completada",label:"Completada"}];return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary-color border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Cargando tus reservas..."})]})}):!J&&!D?e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:e.jsxs("div",{className:"text-center p-8 bg-secondary-color bg-opacity-20 rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-main-text-color mb-4",children:"Sesión no iniciada"}),e.jsx("p",{className:"text-secondary-text-color mb-6",children:"Para ver tus reservas, por favor inicia sesión o crea una nueva cuenta."}),e.jsxs("div",{className:"flex justify-center gap-4 items-center",children:[e.jsx("a",{href:"/login",className:"px-6 py-3 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition-colors",children:"Iniciar Sesión"}),e.jsx("a",{href:"/signup",className:"px-6 py-3 bg-secondary-color text-main-text-color rounded-lg hover:bg-opacity-80 transition-colors",children:"Crear Cuenta"})]})]})}):A?e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:e.jsxs("div",{className:"text-center p-8 bg-red-50 rounded-lg",children:[e.jsxs("p",{className:"text-red-500 font-semibold text-lg",children:["¡Ups! ",A]}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Por favor, intenta recargar la página."}),e.jsx("button",{onClick:()=>{T(),u(null)},className:"mt-4 px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition-colors",children:"Reintentar"})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:[f&&e.jsxs("div",{className:"mb-4 p-4 bg-green-100 text-green-800 rounded-lg flex items-center justify-between",children:[e.jsx("p",{children:f}),e.jsx("button",{onClick:()=>_(null),children:e.jsx(P,{size:20})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-main-text-color",children:"Mis Reservas"}),e.jsx("p",{className:"text-secondary-text-color mt-2",children:"Gestiona tus talleres de cocina y revisa detalles importantes de tus clases."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("div",{className:"flex-1 w-full md:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre o estado...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent",value:b,onChange:s=>O(s.target.value)}),e.jsx(de,{className:"absolute left-3 top-2.5 text-gray-400",size:18})]})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>L(!v),className:"flex items-center gap-2 px-4 py-2 bg-secondary-color text-main-text-color rounded-lg hover:bg-opacity-80 transition-colors",children:[e.jsx(ce,{size:18}),e.jsx("span",{children:"Filtrar"}),v?e.jsx(le,{size:18}):e.jsx(re,{size:18})]}),v&&e.jsx("div",{className:"absolute right-0 mt-2 w-60 bg-white rounded-lg shadow-lg z-10 border",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Estado de Reserva"}),e.jsx("div",{className:"space-y-2",children:Z.map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`status-${s.value}`,name:"status",value:s.value,checked:w===s.value,onChange:()=>{U(s.value),L(!1)},className:"w-4 h-4 text-primary-color focus:ring-primary-color"}),e.jsx("label",{htmlFor:`status-${s.value}`,className:"ml-2 text-sm text-gray-700",children:s.label})]},s.value))})]})})]})]}),e.jsxs("div",{className:"mb-4 text-secondary-text-color",children:["Mostrando ",S.length," de ",z.length," reservas"]}),S.length===0?e.jsx("div",{className:"text-center p-8 bg-secondary-color bg-opacity-20 rounded-lg",children:e.jsx("p",{className:"text-secondary-text-color",children:"No se encontraron reservas con los filtros aplicados."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(s=>{const t=I[s.workshop_id]||"/api/placeholder/400/300";return e.jsxs("div",{className:"bg-white border border-[#e0dfdf] overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer",onClick:()=>q(s),children:[e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:t,alt:s.workshop_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"font-bold text-lg text-main-text-color mb-2 truncate",children:s.workshop_name}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(B,{className:"text-primary-color mr-2",size:16}),e.jsx("span",{className:"text-sm text-secondary-text-color",children:E(s.workshop_date)})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(H,{className:"text-primary-color mr-2",size:16}),e.jsxs("span",{className:"text-sm text-secondary-text-color",children:[g(s.workshop_start_time)," - ",g(s.workshop_end_time)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.payment_status?.toLowerCase()==="pagado"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.payment_status||"Pendiente"}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.status?.toLowerCase()==="confirmada"?"bg-blue-100 text-blue-800":s.status?.toLowerCase()==="cancelada"?"bg-red-100 text-red-800":s.status?.toLowerCase()==="completada"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:s.status||"Pendiente"})]})]})]},s.id)})}),x&&e.jsx(K,{reservation:x}),p&&e.jsx(Y,{reservation:p})]})};export{Ne as default};

import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.RH_Wq4ov.js";import{X as M}from"./x.C9bScxff.js";import{c as o}from"./createLucideIcon.CFjhCtiB.js";import{C as D}from"./calendar.CLrY_9Yq.js";import{C as G}from"./clock.iALahFT7.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],W=o("chevron-down",V);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],q=o("chevron-up",Q);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],K=o("funnel",Y);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ee=o("search",Z);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],te=o("tag",se);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],le=o("triangle-alert",ae),A={1:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuMuhOjpzB02MisAEvYjHQhPGucaFX54CJrUOn",2:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu7htBM8RilvS4mGda0BVPYjrps1H5Lf6DObNF",3:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuBHsdxLPb6lrQWNcyYFdnfEzkeVHJXgoMawmD",4:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibutFnAGpualz2QAIYZWuOfsk5nxJDdbcVy1pe4",5:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibutHioByualz2QAIYZWuOfsk5nxJDdbcVy1pe4",6:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibumctXQLNrPvHGd1j2UM5sACiWEgXI6atVnYyz",7:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuuXdUT8fyXR7wfFas8jC0PIStrJ3dMb4ZeBKD",8:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuInmtowlAyO8kqw0XmJiTH3EQFBVbCG4o2UaS",9:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuEbSDr1NQ3G5DiXUHsPJjl4xCBKmyotakWeFZ",10:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu6VjN9FHvu4jTO7gzRm3dXnqYyJGwxA5VLMkc",11:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibuabLKK2ABUdWKHfOIM621lGQbSXNs5CArhFxz",12:"https://hd51x5cptm.ufs.sh/f/lhdSxG5nEibu5F9013ZRtlECNGU1HWj4bcvBhzO65xgwroMF"},ue=()=>{const[x,F]=t.useState(null),[w,T]=t.useState([]),[k,C]=t.useState(!0),[S,_]=t.useState(null),[h,P]=t.useState(""),[u,$]=t.useState("all"),[p,E]=t.useState(!1),[n,f]=t.useState(null),[re,oe]=t.useState({}),[B,ce]=t.useState(!1),[d,g]=t.useState(null),[j,z]=t.useState(!1),[i,b]=t.useState(null);t.useEffect(()=>{R(),window.scrollTo(0,0)},[]),t.useEffect(()=>{x?verifyAuthToken():C(!1)},[x]),t.useEffect(()=>{if(i){const s=setTimeout(()=>{b(null)},5e3);return()=>clearTimeout(s)}},[i]);const R=()=>{const a=document.cookie.split(";").find(l=>l.trim().startsWith("auth_token="));if(a){const l=a.trim().substring(11);F(l)}else console.log("No se encontró token de autenticación en cookies"),C(!1)},H=async(s,a,l=!0)=>{try{const c=await fetch(`https://booking-service.mangoflower-5e37f0a4.eastus.azurecontainerapps.io/api/reservations/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:a})});if(!c.ok)throw new Error(`Error al actualizar la reserva: ${c.status}`);return T(r=>r.map(v=>v.id===s?{...v,status:a}:v)),n&&n.id===s&&f(r=>({...r,status:a})),l&&b({Cancelada:"Reserva cancelada exitosamente",Confirmada:"Reserva confirmada exitosamente",Completada:"Reserva marcada como completada"}[a]||"Estado de reserva actualizado"),!0}catch(c){return console.error("Error updating reservation status:",c),_("Error al cancelar la reserva. Por favor, inténtalo de nuevo."),!1}},I=async()=>{if(!d)return;z(!0);const s=await H(d.id,"Cancelada");z(!1),s&&g(null)},y=s=>{const a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date(s).toLocaleDateString("es-ES",a)},m=s=>s,N=w.filter(s=>{const a=s.workshop_name.toLowerCase().includes(h.toLowerCase())||s.status.toLowerCase().includes(h.toLowerCase()),l=u==="all"||s.status.toLowerCase()===u.toLowerCase();return a&&l}),O=s=>{f(s)},L=()=>{f(null)},X=({reservation:s})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4 text-red-600",children:[e.jsx(le,{size:24,className:"mr-2"}),e.jsx("h2",{className:"text-xl font-bold",children:"¿Cancelar reserva?"})]}),e.jsxs("p",{className:"mb-6",children:["¿Estás seguro de que deseas cancelar tu reserva para ",e.jsx("strong",{children:s.workshop_name})," del ",y(s.workshop_date),"? Esta acción no se puede deshacer."]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:j,children:"Volver"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Cancelando..."]}):"Cancelar Reserva"})]})]})}):null,U=({reservation:s})=>{if(!s)return null;const a=A[s.workshop_id]||"/api/placeholder/400/300",l=new Date,r=new Date(s.workshop_date)>l&&s.status!=="Cancelada"&&s.status!=="Completada";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg border border-[#e0dfdf] w-full max-w-3xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Detalles de la Reserva"}),e.jsx("button",{onClick:L,className:"text-gray-500 hover:text-gray-700",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("img",{src:a,alt:s.workshop_name,className:"w-full h-64 object-cover"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.workshop_name}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"text-gray-500 mr-2",size:16}),e.jsx("span",{children:y(s.workshop_date)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"text-gray-500 mr-2",size:16}),e.jsxs("span",{children:[m(s.workshop_start_time)," - ",m(s.workshop_end_time)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"text-gray-500 mr-2",size:16}),e.jsxs("span",{children:["Modalidad: ",s.workshop_modality]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium mr-2 ${s.payment_status?.toLowerCase()==="pagado"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:["Pago: ",s.payment_status||"Pendiente"]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status?.toLowerCase()==="confirmada"?"bg-blue-100 text-blue-800":s.status?.toLowerCase()==="cancelada"?"bg-red-100 text-red-800":s.status?.toLowerCase()==="completada"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:["Estado: ",s.status||"Pendiente"]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"font-semibold",children:"Precio:"}),e.jsxs("p",{className:"text-2xl font-bold text-accent-color",children:["$",s.workshop_price]})]}),r&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{L(),g(s)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Cancelar Reserva"})})]})]}),e.jsx("div",{className:"mt-6 border-t pt-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Reserva #",s.id," • Creada el ",new Date(s.created_at).toLocaleDateString()]})})]})})})},J=[{value:"all",label:"Todos los estados"},{value:"confirmada",label:"Confirmada"},{value:"cancelada",label:"Cancelada"},{value:"completada",label:"Completada"}];return k?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-primary-color border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Cargando tus reservas..."})]})}):!B&&!k?e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:e.jsxs("div",{className:"text-center p-8 bg-secondary-color bg-opacity-20 rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-main-text-color mb-4",children:"Sesión no iniciada"}),e.jsx("p",{className:"text-secondary-text-color mb-6",children:"Para ver tus reservas, por favor inicia sesión o crea una nueva cuenta."}),e.jsxs("div",{className:"flex justify-center gap-4 items-center",children:[e.jsx("a",{href:"/login",className:"px-6 py-3 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition-colors",children:"Iniciar Sesión"}),e.jsx("a",{href:"/signup",className:"px-6 py-3 bg-secondary-color text-main-text-color rounded-lg hover:bg-opacity-80 transition-colors",children:"Crear Cuenta"})]})]})}):S?e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:e.jsxs("div",{className:"text-center p-8 bg-red-50 rounded-lg",children:[e.jsxs("p",{className:"text-red-500 font-semibold text-lg",children:["¡Ups! ",S]}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Por favor, intenta recargar la página."}),e.jsx("button",{onClick:()=>{R(),_(null)},className:"mt-4 px-4 py-2 bg-primary-color text-white rounded-lg hover:bg-opacity-90 transition-colors",children:"Reintentar"})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 mt-20",children:[i&&e.jsxs("div",{className:"mb-4 p-4 bg-green-100 text-green-800 rounded-lg flex items-center justify-between",children:[e.jsx("p",{children:i}),e.jsx("button",{onClick:()=>b(null),children:e.jsx(M,{size:20})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-main-text-color",children:"Mis Reservas"}),e.jsx("p",{className:"text-secondary-text-color mt-2",children:"Gestiona tus talleres de cocina y revisa detalles importantes de tus clases."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("div",{className:"flex-1 w-full md:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre o estado...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-color focus:border-transparent",value:h,onChange:s=>P(s.target.value)}),e.jsx(ee,{className:"absolute left-3 top-2.5 text-gray-400",size:18})]})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>E(!p),className:"flex items-center gap-2 px-4 py-2 bg-secondary-color text-main-text-color rounded-lg hover:bg-opacity-80 transition-colors",children:[e.jsx(K,{size:18}),e.jsx("span",{children:"Filtrar"}),p?e.jsx(q,{size:18}):e.jsx(W,{size:18})]}),p&&e.jsx("div",{className:"absolute right-0 mt-2 w-60 bg-white rounded-lg shadow-lg z-10 border",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Estado de Reserva"}),e.jsx("div",{className:"space-y-2",children:J.map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`status-${s.value}`,name:"status",value:s.value,checked:u===s.value,onChange:()=>{$(s.value),E(!1)},className:"w-4 h-4 text-primary-color focus:ring-primary-color"}),e.jsx("label",{htmlFor:`status-${s.value}`,className:"ml-2 text-sm text-gray-700",children:s.label})]},s.value))})]})})]})]}),e.jsxs("div",{className:"mb-4 text-secondary-text-color",children:["Mostrando ",N.length," de ",w.length," reservas"]}),N.length===0?e.jsx("div",{className:"text-center p-8 bg-secondary-color bg-opacity-20 rounded-lg",children:e.jsx("p",{className:"text-secondary-text-color",children:"No se encontraron reservas con los filtros aplicados."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>{const a=A[s.workshop_id]||"/api/placeholder/400/300";return e.jsxs("div",{className:"bg-white border border-[#e0dfdf] overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer",onClick:()=>O(s),children:[e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:a,alt:s.workshop_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"font-bold text-lg text-main-text-color mb-2 truncate",children:s.workshop_name}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(D,{className:"text-primary-color mr-2",size:16}),e.jsx("span",{className:"text-sm text-secondary-text-color",children:y(s.workshop_date)})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(G,{className:"text-primary-color mr-2",size:16}),e.jsxs("span",{className:"text-sm text-secondary-text-color",children:[m(s.workshop_start_time)," - ",m(s.workshop_end_time)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.payment_status?.toLowerCase()==="pagado"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.payment_status||"Pendiente"}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.status?.toLowerCase()==="confirmada"?"bg-blue-100 text-blue-800":s.status?.toLowerCase()==="cancelada"?"bg-red-100 text-red-800":s.status?.toLowerCase()==="completada"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:s.status||"Pendiente"})]})]})]},s.id)})}),n&&e.jsx(U,{reservation:n}),d&&e.jsx(X,{reservation:d})]})};export{ue as default};
